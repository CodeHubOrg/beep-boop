<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Beep Boop</title>

        <link rel="stylesheet" href="/css/normalize.css">
        <link rel="stylesheet" href="/css/grid.css">
        <link rel="stylesheet" href="/css/beep-boop.css">
            

    </head>

    <body>
        <div id="main"></div>
    </body>

    <!-- js libraries inc. React and Socket.io -->
    <script src="https://fb.me/react-0.14.7.js"></script>
    <script src="https://fb.me/react-dom-0.14.7.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>

    <script type="text/babel">

        var Display = React.createClass({
            render: function(){
                console.log(this.props);
                var message_class = (this.props.received) ? 'message-received' : 'welcome';
                return (
                <div className="display-screen center bg-white push-down">
                    <p className={message_class}>{this.props.message}</p>
                </div>
                );
            }
        });

        var Button = React.createClass({
            handleButtonPress: function(){
                if(this.props.button.text != 'Reset'){
                    var message = this.props.button.text;
                    this.props.socket.emit('chat message', message);
                    this.props.onUpdate(message);
                } 
            },
            render: function() {
                var grid = "grid__cell center aligned " + this.props.button.grid;
                var selectors = "ui button massive push-down-half " + this.props.button.colour;
                return(
                    <div className={grid}>
                        <button className={selectors} onClick={this.handleButtonPress}>{this.props.button.text}</button>
                    </div>
                );
            }
        });


        var App = React.createClass({
			getInitialState: function() {
				return {
                    messageSent: "You have not sent a message yet."
                }
			},
            handleButton: function(button_text){
                var message = 'You sent a "'+button_text+'"';
                this.setState({messageSent: message});
            },
			render: function() {
                var socket = this.props.socket;     
                var message = (this.props.msg) ? this.props.msg : 'Welcome to Beep Boop. Please send a message.';
                var received = (this.props.msg) ? true : false;
                console.log("this is the state", this.state);
				return(
                    <div className="wrapper">
                        <Display message={message} received={received} />
                        <div className="segment padded"> 
                            <div className="beep-booped center font-standard padded bg-white push-down">
                                {this.state.messageSent}      
                            </div>
                        </div> 
                        <div className="segment padded-large"> 
                            <Button button={{colour: "pink", text: "Beep", grid:"u-1/2--medium u-1/3--large" }} socket={socket} onUpdate={this.handleButton} />
                            <Button button={{colour: "green", text: "Boop", grid:"u-1/2--medium u-1/3--large" }} socket={socket} onUpdate={this.handleButton} />
                            <Button button={{colour: "gray", text: "Reset", grid:"u-1/3--large" }} socket={socket} onUpdate={this.handleButton} />
                        </div>
                    </div>
				);
			}
		});

        var socket = io();

        ReactDOM.render(
            <App title='Beep Boop' socket={socket} />,
            document.getElementById('main')
        );

        socket.on('chat message', function(msg){
            ReactDOM.render(
                <App title='Beep Boop' socket={socket} msg={msg} />,
                document.getElementById('main')
            );
        });


    </script>
</html>
